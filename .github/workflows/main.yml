name: "deploy .NET Core Desktop"

on:
    push:
        tags:
            - "TableTopCrucible3/v*"

env:
    PROJECT_PATH: TableTopCrucible.App.WPF/TableTopCrucible.App.WPF.csproj

jobs:
    deploy: 
        runs-on: windows-latest
        steps: 
        - uses: actions/checkout@v2

        - uses: actions/setup-dotnet@v1
          with: 
            dotnet-version: 3.1.x
        
        - run:  dotnet clean ${{ env.PROJECT_PATH }} --configuration Release && dotnet nuget locals all --clear

        - run: dotnet restore ${{ env.PROJECT_PATH }}

        - run: dotnet build ${{ env.PROJECT_PATH }} -c Release --no-restore

        - run: dotnet publish ${{ env.PROJECT_PATH }} -c Release --self-contained -r win-x64 -p:PublishSingleFile=true --no-build

#   - uses: actions/create-release@v1
#     env: 
#       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#     with:
#       tag_name: ${{ github.ref }}